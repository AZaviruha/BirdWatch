@(tweets: Seq[Tweet])(implicit request: RequestHeader)

@main("Tweets!") {
  <script src="@routes.Assets.at("javascripts/d3-min.js")" type="text/javascript"></script>
  <script src="@routes.Assets.at("javascripts/d3.layout.cloud.js")" type="text/javascript"></script>
  
  <script type="text/javascript">
  $(function() {
    var ws = new WebSocket("@routes.Twitter.tweetFeed.webSocketURL()")

    // Overall viewmodel for this screen, along with initial state
    var TweetsViewModel = function() {
      this.tweets = ko.observableArray();
    }
    var viewModel = new TweetsViewModel()
    ko.applyBindings(viewModel);
    
    // d3 word cloud
    var fill = d3.scale.category20();
    var fontSize = d3.scale.log().range([10, 90]);

    var wordList = [ {text: "amsterdam", size: 90}, 
    {text: "hamburg", size: 45}, 
    {text: "#amsterdam", size: 60}, 
    {text: "schnee", size: 26}, 
    {text: "#hamburg", size: 17}, 
    {text: "morgen", size: 13}, 
    {text: "arena", size: 11},  
    {text: "tomtom", size: 11},  
    {text: "from", size: 10}, 
    {text: "naar", size: 10}, 
    {text: "ajax ", size: 10}, 
    {text: "tomthewanted", size: 9},
    {text: "wanna", size: 9}, 
    {text: "birthday", size: 9},  
    {text: "hoor", size: 8}, 
    {text: "with", size: 8},
    {text: "zwischen", size: 8}, 
    {text: "will", size: 8} ]

    d3.layout.cloud()
          .size([1200, 800])
          .timeInterval(3)
          //.text(function(d) { return d.text; })
          .font("Impact")
          .fontSize(function(d) { return fontSize(d.size/2); })
          .rotate(function(d) { return ~~(Math.random() * 5) * 30 - 60; })
          .padding(1)
          .words(wordList)
          .on("end", draw)
          .start();

    function draw(words) {
      d3.select("body").append("svg")
          .attr("width", 1200)
          .attr("height", 800)
          .append("g")
          .attr("transform", "translate(150,150)")
          .selectAll("text")
          .data(words)
          .enter().append("text")
          .style("font-size", function(d) { return d.size / 3 + "px"; })
          .style("font-family", "Impact")
          .style("fill", function(d, i) { return fill(i); })
          .attr("text-anchor", "middle")
          .attr("transform", function(d) {
            return "translate(" + [50 + d.x/3, 50 + d.y/3] + ")rotate(" + d.rotate + ")";
          })
          .text(function(d) { return d.text; });
    }
      
    ws.onmessage = function(msg){
      console.log(msg.data)
      var data = JSON.parse(msg.data)
      viewModel.tweets(data.tweetList)
      //viewModel.tweets.unshift(JSON.parse(msg.data))
      //if(viewModel.tweets().length > 20) viewModel.tweets.pop()
    }
  })
  </script>

  <h1>Tweets:</h1>
  @tweets.map { tweet =>
  <!--ul>
    <li><span>@tweet.screen_name</span>: @tweet.text - @tweet.created_at
  </ul-->
  } 
  <ul data-bind="foreach: tweets">
    <li><span data-bind="text: screen_name"></span>: <span data-bind="text: text"></span> - <span data-bind="text: timestamp"></span>
  </ul>
}