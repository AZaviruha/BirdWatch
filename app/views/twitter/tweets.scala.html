@(tweets: Seq[Tweet])(implicit request: RequestHeader)

@mainEmpty("Tweets!") {
  <script src="@routes.Assets.at("javascripts/d3.js")" type="text/javascript"></script>
  <script src="@routes.Assets.at("javascripts/d3.layout.cloud.js")" type="text/javascript"></script>
  
  <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/dw.css")">
  
 
  <div id="header"><h1>BirdWatch</h1></div>

  <div id="wordcloud"></div>

  <div id="wordBars"></div>

  <div id="tweets">
    <ul data-bind="foreach: tweets">
      <li><div class="tweetlist"><span><img data-bind="attr: { src: img_url }" /></span><div class="screen_name" data-bind="text: screen_name"></div>&nbsp;&nbsp;&nbsp;&nbsp;<div class="timeInterval" data-bind="text: timeAgo"></div><br /><div class="tweettext"><span data-bind="text: text"><br /></span></div></div></li>
    </ul>
  </div>
    
  @tweets.map { tweet =>
  <!--ul>
    <li><span>@tweet.screen_name</span>: @tweet.text - @tweet.created_at
  </ul-->
  } 
  
  <script src="@routes.Assets.at("javascripts/barchart.js")" type="text/javascript"></script>
  <script src="@routes.Assets.at("javascripts/wordcloud.js")" type="text/javascript"></script>
  
  <script type="text/javascript">
  birdWatch = birdWatch || {};

   $(function() {
     var ws = new WebSocket("@routes.Twitter.tweetFeed.webSocketURL()")

     // Overall viewmodel for this screen, along with initial state
     var TweetsViewModel = function() { this.tweets = ko.observableArray(); }
     var viewModel = new TweetsViewModel()
     ko.applyBindings(viewModel);

     birdWatch.wordCountBarChart.init();
     birdWatch.wordCloud.init();
     
     var lastUpdated = new Date().getTime() - 2000;
     
     ws.onmessage = function(msg){
       var data = JSON.parse(msg.data)
       viewModel.tweets.unshift(data.tweetList[0])
       if(viewModel.tweets.length > 0) { viewModel.tweets.pop() }
       
       if ( (new Date().getTime() - lastUpdated) > 100) {
         birdWatch.wordCountBarChart.redraw(data.topWords);
       }
       if ( (new Date().getTime() - lastUpdated) > 5000) {
         birdWatch.wordCloud.redraw(data.topWords);
       }
     }
   })
   </script>
  
}